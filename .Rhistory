((has.j && !length(j)) || (has.i && !length(i) && !has.j))
cl <- oldClass(x)
class(x) <- NULL
new.cols <- NULL
nvars <- length(x)
?oldClass
nvars <- length(x)
nrows <- .row_names_info(x, 2L)
(has.i && length(i))
(has.j)
anyNA(j)
is.character(j)
"" %in% j
match(j, names(x))
(has.i && !length(iseq) && all(1L <= jseq & jseq <= nvars))
(anyDuplicated(jseq))
anyDuplicated(jseq)
length(iseq)
(has.i && length(i))
(has.i && !length(iseq) && all(1L <= jseq & jseq <= nvars))
(anyDuplicated(jseq))
length(iseq)
(is.null(value))
(!is.list(value))
value
NROW(value)
nrow(value)
?NROW
sprintf(ngettext(N, "replacement has %d row, data has %d",
"replacement has %d rows, data has %d"), N,
n)
time
x
length(x)
F2 <- function(predRE, data, time){
f2 <- function(t){
predY(predRE, data, time, tLM = t)
}
integrate(f2, lower = 0, upper = 4)$value
}
integrate(f2, lower = 0, upper = 4)$value
predRE$b_i
predRE$beta
length(predRE)
integrate(F2(predRE, data, time), lower = 0, upper = 4)$value
F2 <- function(predRE, data, time){
f2 <- function(t){
predY(predRE, data, time, tLM = t)
}
return(f2)
}
integrate(F2(predRE, data, time), lower = 0, upper = 4)$value
F2 <- function(z){
f2 <- function(t){
exp(-t)*t^(1-1/2)*(1+t/2*z)^(1-1/2)
}
return(f2)
}
int2 <- function (z) {
integrate(F2(z),  lower=0, upper=Inf)$value
}
F2(1)
F2 <- function(predRE, data, time){
f2 <- function(t){
predY(predRE, data, time, tLM = t)
}
return(f2)
}
F2(predRE, data, time)
predRE
F2 <- function(predRE, data, time){
f2 <- function(t){
predY(predRE, data, time, tLM = t)
}
return(f2)
}
int2 <- function(predRE, data, time){
integrate(F2(predRE, data, time), lower = 0, upper = 4)$value
}
int2(predRE, data, time)
int2vec<-function(t) sapply(t,int2)
int2sec(1)
int2vec(1)
library(hdlandmark)
pred_RE
1:1
library(hdlandmark)
knitr::opts_chunk$set(echo = TRUE)
library(joineRML)
library(dplyr)
library(lcmm)
library(nlme)
library(ggplot2)
library(mfp)
library(hdlandmark)
data("pbc2")
str(pbc2)
pbc2$id <- as.integer(pbc2$id)
pbc2_landmark <- pbc2[which(pbc2$year<4),]
quantile(table(pbc2_landmark$id))
normality_hist <- function(data, var_time, var_quanti, nb_quantile){
quant_year <- quantile(data[,var_time],
probs = seq(from = 0, to = 1, length.out = nb_quantile))
par(mfrow = c(round(sqrt(nb_quantile)),round(sqrt(nb_quantile))))
for(i in seq_len(nb_quantile - 1)){
hist(data[which(quant_year[i] <= data[,var_time] &
quant_year[i + 1] >= data[,var_time]), var_quanti],
breaks = 30, col = "blue",
main = paste(round(quant_year[i], 1), "<=", "year", "<=",
round(quant_year[i+1], 1)),
xlab = paste(var_quanti,"value"))
}
}
hist(pbc2_landmark$serBilir, breaks = 30)
normality_hist(pbc2_landmark, "year", "serBilir", 5)
# probleme de normalité
pbc2_landmark$serBilir2 <- log(pbc2_landmark$serBilir+0.1)
hist(pbc2_landmark$serBilir2, breaks = 30)
normality_hist(pbc2_landmark, "year", "serBilir2", 5)
ggplot(pbc2_landmark) +
geom_line(aes(x = year, y = serBilir2, group = id), color = "grey30", alpha = 0.8) +
stat_smooth(aes(x = year, y = serBilir2), method = "loess", size = 0.75, color = "red") +
theme_bw()
pf <- mfp(serBilir2 ~ fp(year, df = 4, select = 1, scale = TRUE), data = pbc2_landmark)
pf
lmm_serBilir <- hlme(fixed = serBilir2~year+age+sex+drug+
year*age+year*sex+year*drug,
random = ~1+year,
subject = 'id',
data = pbc2_landmark)
summary(lmm_serBilir)
lmm_serBilir <- hlme(fixed = serBilir2~year+sex+
year*sex,
random = ~1+year,
subject = 'id',
data = pbc2_landmark)
summary(lmm_serBilir)
plot(lmm_serBilir)
hist(pbc2_landmark$serChol, breaks = 30)
normality_hist(pbc2_landmark, "year", "serChol", 5)
# probleme de normalité
pbc2_landmark$serChol2 <- log(pbc2_landmark$serChol+0.1)
hist(pbc2_landmark$serChol2, breaks = 30)
normality_hist(pbc2_landmark, "year", "serChol2", 5)
ggplot(pbc2_landmark) +
geom_line(aes(x = year, y = serChol2, group = id), color = "grey30", alpha = 0.8) +
stat_smooth(aes(x = year, y = serChol2), method = "loess", size = 0.75, color = "red") +
theme_bw()
pf <- mfp(serChol2 ~ fp(year, df = 4, select = 1, scale = TRUE), data = pbc2_landmark)
pf
lmm_serChol <- hlme(fixed = serChol2~year+age+sex+drug+
year*age+year*sex+year*drug,
random = ~1+year,
subject = 'id',
data = pbc2_landmark)
summary(lmm_serChol)
lmm_serChol <- hlme(fixed = serChol2~year+age,
random = ~1+year,
subject = 'id',
data = pbc2_landmark)
summary(lmm_serChol)
plot(lmm_serChol)
hist(pbc2_landmark$albumin, breaks = 30)
normality_hist(pbc2_landmark, "year", "albumin", 5)
# probleme de normalité
pbc2_landmark$albumin2 <- log(pbc2_landmark$albumin+0.1)
hist(pbc2_landmark$albumin2, breaks = 30)
normality_hist(pbc2_landmark, "year", "albumin2", 5)
ggplot(pbc2_landmark) +
geom_line(aes(x = year, y = albumin2, group = id), color = "grey30", alpha = 0.8) +
stat_smooth(aes(x = year, y = albumin2), method = "loess", size = 0.75, color = "red") +
theme_bw()
pf <- mfp(albumin2 ~ fp(year, df = 4, select = 1, scale = TRUE), data = pbc2_landmark)
pf
lmm_albumin <- hlme(fixed = albumin2~year+age+sex+drug+
year*age+year*sex+year*drug,
random = ~1+year,
subject = 'id',
data = pbc2_landmark)
summary(lmm_albumin)
lmm_albumin <- hlme(fixed = albumin2~year+age,
random = ~1+year,
subject = 'id',
data = pbc2_landmark)
summary(lmm_albumin)
plot(lmm_albumin)
hist(pbc2_landmark$alkaline, breaks = 30)
normality_hist(pbc2_landmark, "year", "alkaline", 5)
# probleme de normalité
pbc2_landmark$alkaline2 <- log(pbc2_landmark$alkaline+0.1)
hist(pbc2_landmark$alkaline2, breaks = 30)
normality_hist(pbc2_landmark, "year", "alkaline2", 5)
ggplot(pbc2_landmark) +
geom_line(aes(x = year, y = alkaline2, group = id), color = "grey30", alpha = 0.8) +
stat_smooth(aes(x = year, y = alkaline2), method = "loess", size = 0.75, color = "red") +
theme_bw()
pf <- mfp(alkaline2 ~ fp(year, df = 4, select = 1, scale = TRUE), data = pbc2_landmark)
pf
lmm_alkaline <- hlme(fixed = alkaline2~year+age+sex+drug+
year*age+year*sex+year*drug,
random = ~1+year,
subject = 'id',
data = pbc2_landmark)
summary(lmm_alkaline)
lmm_alkaline <- hlme(fixed = alkaline2~year+age+
year*age,
random = ~1+year,
subject = 'id',
data = pbc2_landmark)
summary(lmm_alkaline)
plot(lmm_alkaline)
hist(pbc2_landmark$SGOT, breaks = 30)
normality_hist(pbc2_landmark, "year", "SGOT", 5)
# probleme de normalité
pbc2_landmark$SGOT2 <- log(pbc2_landmark$SGOT+0.1)
hist(pbc2_landmark$SGOT2, breaks = 30)
normality_hist(pbc2_landmark, "year", "SGOT2", 5)
ggplot(pbc2_landmark) +
geom_line(aes(x = year, y = SGOT2, group = id), color = "grey30", alpha = 0.8) +
stat_smooth(aes(x = year, y = SGOT2), method = "loess", size = 0.75, color = "red") +
theme_bw()
pf <- mfp(SGOT2 ~ fp(year, df = 4, select = 1, scale = TRUE), data = pbc2_landmark)
pf
lmm_SGOT <- hlme(fixed = SGOT2~year+age+sex+drug+
year*age+year*sex+year*drug,
random = ~1+year,
subject = 'id',
data = pbc2_landmark)
summary(lmm_SGOT)
lmm_SGOT <- hlme(fixed = SGOT2~year+age+sex+drug+
year*sex,
random = ~1+year,
subject = 'id',
data = pbc2_landmark)
summary(lmm_SGOT)
plot(lmm_SGOT)
hist(pbc2_landmark$platelets, breaks = 30)
normality_hist(pbc2_landmark, "year", "platelets", 5)
# probleme de normalité
pbc2_landmark$platelets2 <- log(pbc2_landmark$platelets+0.1)
hist(pbc2_landmark$platelets2, breaks = 30)
normality_hist(pbc2_landmark, "year", "platelets2", 5)
ggplot(pbc2_landmark) +
geom_line(aes(x = year, y = platelets2, group = id), color = "grey30", alpha = 0.8) +
stat_smooth(aes(x = year, y = platelets2), method = "loess", size = 0.75, color = "red") +
theme_bw()
pf <- mfp(platelets2 ~ fp(year, df = 4, select = 1, scale = TRUE), data = pbc2_landmark)
pf
lmm_platelets <- hlme(fixed = platelets2~year+age+sex+drug+
year*age+year*sex+year*drug,
random = ~1+year,
subject = 'id',
data = pbc2_landmark)
summary(lmm_platelets)
lmm_platelets <- hlme(fixed = platelets2~year+age,
random = ~1+year,
subject = 'id',
data = pbc2_landmark)
summary(lmm_platelets)
plot(lmm_platelets)
hist(pbc2_landmark$prothrombin, breaks = 30)
normality_hist(pbc2_landmark, "year", "prothrombin", 5)
# probleme de normalité
pbc2_landmark$prothrombin2 <- log(pbc2_landmark$prothrombin+0.1)
hist(pbc2_landmark$prothrombin2, breaks = 30)
normality_hist(pbc2_landmark, "year", "prothrombin2", 5)
ggplot(pbc2_landmark) +
geom_line(aes(x = year, y = prothrombin2, group = id), color = "grey30", alpha = 0.8) +
stat_smooth(aes(x = year, y = prothrombin2), method = "loess", size = 0.75, color = "red") +
theme_bw()
pf <- mfp(prothrombin2 ~ fp(year, df = 4, select = 1, scale = TRUE), data = pbc2_landmark)
pf
lmm_prothrombin <- hlme(fixed = prothrombin2~year+age+sex+drug+
year*age+year*sex+year*drug,
random = ~1+year,
subject = 'id',
data = pbc2_landmark)
summary(lmm_prothrombin)
lmm_prothrombin <- hlme(fixed = prothrombin2~year+sex,
random = ~1+year,
subject = 'id',
data = pbc2_landmark)
summary(lmm_prothrombin)
plot(lmm_prothrombin)
deriv_serBilir <- list(fixed = ~ 1 + sex,
indFixed = c(2,4),
random = ~ 1,
indRandom = 2)
deriv_serChol <- list(fixed = ~ 1,
indFixed = 2,
random = ~ 1,
indRandom = 2)
deriv_albumin <- list(fixed = ~ 1,
indFixed = 2,
random = ~ 1,
indRandom = 2)
deriv_alkaline <- list(fixed = ~ 1 + age,
indFixed = c(2,4),
random = ~ 1,
indRandom = 2)
deriv_SGOT <- list(fixed = ~ 1 + sex,
indFixed = c(2,6),
random = ~ 1,
indRandom = 2)
deriv_platelets <- list(fixed = ~ 1,
indFixed = 2,
random = ~ 1,
indRandom = 2)
deriv_prothrombin <- list(fixed = ~ 1,
indFixed = 2,
random = ~ 1,
indRandom = 2)
deriv <- list(deriv_serBilir, deriv_serChol, deriv_albumin, deriv_alkaline,
deriv_SGOT, deriv_platelets, deriv_prothrombin)
lmm <- list(lmm_serBilir, lmm_serChol, lmm_albumin, lmm_alkaline, lmm_SGOT,
lmm_platelets, lmm_prothrombin)
pbc2_tLM_pred <- landmark(lmm_objects = lmm, data = pbc2_landmark, tLM = 4, subject = "id", time = "year",
derivForm_objects = deriv)
pred_RE$b_i
data_surv[which(data_surv[, subject] %in% rownames(pred_RE$b_i)),
(ncol(data_surv) + 1):(ncol(data_surv) + ncol(pred_RE$b_i))]
View(data_surv)
colnames(data_surv)
colnames(data_surv)[ncol(data_surv)]
colnames(data_surv)[(ncol(data_surv)-ncol(pred_RE$b_i)+1):(ncol(data_surv))]
colnames(pred_RE$b_i)
paste(marker_name, "RE", colnames(pred_RE$b_i), sep = "_")
library(hdlandmark)
library(hdlandmark)
knitr::opts_chunk$set(echo = TRUE)
library(joineRML)
library(dplyr)
library(lcmm)
library(nlme)
library(ggplot2)
library(mfp)
library(hdlandmark)
data("pbc2")
pbc2_tLM_pred <- landmark(lmm_objects = lmm, data = pbc2_landmark, tLM = 4, subject = "id", time = "year",
derivForm_objects = deriv)
View(pbc2_tLM_pred)
pbc2_tLM_pred$years4 <- pbc2_tLM_pred$years - 4
pbc2_tLM_pred <- pbc2_tLM_pred[which(pbc2_tLM_pred$years4>0),]
# censure au temps horizon tHor
tHor <- 3
pbc2_tLM_pred$status2_censure <- pbc2_tLM_pred$status2
pbc2_tLM_pred$status2_censure[pbc2_tLM_pred$years4 > tHor] <- 0
pbc2_tLM_pred$years4_censure <- pmin(pbc2_tLM_pred$years4, tHor)
table(pbc2_tLM_pred$status2_censure)
KM <- survfit(Surv(years4_censure, status2_censure) ~ 1, data = pbc2_tLM_pred)
plot(KM)
View(pbc2_tLM_pred)
colnames(pbc2_tLM_pred)
coxFit <- coxph(Surv(years4_censure, status2_censure) ~ drug + age + sex +
serBilir2 + serChol2 + albumin2 + alkaline2 + platelets2 + prothrombin2 + SGOT2 +
serBilir2_slope + serChol2_slope + albumin2_slope + alkaline2_slope +
platelets2_slope + prothrombin2_slope + SGOT2_slope +
serBilir2_RE_(Intercept) + serBilir2_RE_year,
data = pbc2_tLM_pred)
?strsplit
deriv <- list(deriv_serBilir, deriv_serChol, deriv_albumin, deriv_alkaline,
deriv_SGOT, deriv_platelets, deriv_prothrombin)
knitr::opts_chunk$set(echo = TRUE)
library(joineRML)
library(dplyr)
library(lcmm)
library(nlme)
library(ggplot2)
library(mfp)
library(hdlandmark)
data("pbc2")
pbc2_tLM_pred <- landmark(lmm_objects = lmm, data = pbc2_landmark, tLM = 4, subject = "id", time = "year",
derivForm_objects = deriv)
gsub("[\\(\\)]", "", regmatches(j, gregexpr("\\(.*?\\)", b_i_var))[[1]])
gsub("[\\(\\)]", "", regmatches(b_i_var, gregexpr("\\(.*?\\)", b_i_var))[[1]])
regmatches(b_i_var, gregexpr("(?<=\\().*?(?=\\))", b_i_var, perl=T))[[1]]
library(stringr)
str_detect(b_i_var, "(")
?str_detect
regex("(?=\\().*?(?<=\\))")
str_detect(b_i_var, regex("(?=\\().*?(?<=\\))"))
any(str_detect(b_i_var, regex("(?=\\().*?(?<=\\))")))
b_i_var_issue <- str_detect(b_i_var, regex("(?=\\().*?(?<=\\))"))
any(b_i_var_issue)
b_i_var[b_i_var_issue]
regmatches(b_i_var[b_i_var_issue], gregexpr("(?<=\\().*?(?=\\))", b_i_var[b_i_var_issue], perl=T))[[1]]
knitr::opts_chunk$set(echo = TRUE)
library(joineRML)
library(dplyr)
library(lcmm)
library(nlme)
library(ggplot2)
library(mfp)
library(hdlandmark)
data("pbc2")
pbc2_tLM_pred <- landmark(lmm_objects = lmm, data = pbc2_landmark, tLM = 4, subject = "id", time = "year",
derivForm_objects = deriv)
knitr::opts_chunk$set(echo = TRUE)
library(joineRML)
library(dplyr)
library(lcmm)
library(nlme)
library(ggplot2)
library(mfp)
library(hdlandmark)
data("pbc2")
pbc2_tLM_pred <- landmark(lmm_objects = lmm, data = pbc2_landmark, tLM = 4, subject = "id", time = "year",
derivForm_objects = deriv)
View(pbc2_tLM_pred)
library(hdlandmark)
pbc2_tLM_pred <- landmark(lmm_objects = lmm, data = pbc2_landmark, tLM = 4, subject = "id", time = "year",
derivForm_objects = deriv)
View(pbc2_tLM_pred)
knitr::opts_chunk$set(echo = TRUE)
library(joineRML)
library(dplyr)
library(lcmm)
library(nlme)
library(ggplot2)
library(mfp)
library(hdlandmark)
data("pbc2")
pbc2_tLM_pred <- landmark(lmm_objects = lmm, data = pbc2_landmark, tLM = 4, subject = "id", time = "year",
derivForm_objects = deriv)
View(pbc2_landmark)
View(pbc2_tLM_pred)
colnames(pbc2_tLM_pred)
pbc2_tLM_pred$years4 <- pbc2_tLM_pred$years - 4
pbc2_tLM_pred <- pbc2_tLM_pred[which(pbc2_tLM_pred$years4>0),]
# censure au temps horizon tHor
tHor <- 3
pbc2_tLM_pred$status2_censure <- pbc2_tLM_pred$status2
pbc2_tLM_pred$status2_censure[pbc2_tLM_pred$years4 > tHor] <- 0
pbc2_tLM_pred$years4_censure <- pmin(pbc2_tLM_pred$years4, tHor)
table(pbc2_tLM_pred$status2_censure)
KM <- survfit(Surv(years4_censure, status2_censure) ~ 1, data = pbc2_tLM_pred)
plot(KM)
colnames(pbc2_tLM_pred)
coxFit <- coxph(Surv(years4_censure, status2_censure) ~ drug + age + sex +
serBilir2 + serChol2 + albumin2 + alkaline2 + platelets2 + prothrombin2 + SGOT2 +
serBilir2_slope + serChol2_slope + albumin2_slope + alkaline2_slope +
platelets2_slope + prothrombin2_slope + SGOT2_slope +
serBilir2_RE_Intercept + serBilir2_RE_year + serChol2_RE_Intercept + serChol2_RE_year +
albumin2_RE_Intercept + albumin2_RE_year + alkaline2_RE_Intercept + alkaline2_RE_year +
SGOT2_RE_Intercept + SGOT2_RE_year + platelets2_RE_Intercept + platelets2_RE_year +
prothrombin2_RE_Intercept + prothrombin2_RE_year,
data = pbc2_tLM_pred)
summary(coxFit)
coxFit <- coxph(Surv(years4_censure, status2_censure) ~ age +
serBilir2 + serChol2 +
serChol2_slope + albumin2_slope,
data = pbc2_tLM_pred)
summary(coxFit)
res_survfit <- survfit(coxFit, pbc2_tLM_pred)
id_time <- sum(res_survfit$time <= tHor)
res_surv <- data.frame("S_tHor" = res_survfit$surv[id_time,],
"ICinf" = res_survfit$lower[id_time,],
"ICsup" = res_survfit$upper[id_time,])
head(res_surv)
install.packages("pec")
install.packages("timeROC")
coxFit$var
coxFit$terms
coxFit$formula
coxFit$call
as.character(coxFit$formula)
test <- model.matrix(coxFit$formula, pbc2_tLM_pred)
View(test)
View(pbc2_tLM_pred)
sum(is.na(pbc2_tLM_pred$serChol2))
View(pbc2_tLM_pred)
sum(is.na(pbc2_tLM_pred$serChol))
View(pbc2)
View(test)
pec(list("Cox" = coxFit), Hist(years4_censure, status2_censure)~1, data = pbc2_tLM_pred)
library(pec)
PredError <- pec(list("Cox" = coxFit), Hist(years4_censure, status2_censure)~1, data = pbc2_tLM_pred)
install.packages("riskRegression")
PredError <- pec(list("Cox" = coxFit), Hist(years4_censure, status2_censure)~1, data = pbc2_tLM_pred)
?coxph
coxFit <- coxph(Surv(years4_censure, status2_censure) ~ age +
serBilir2 + serChol2 +
serChol2_slope + albumin2_slope,
data = pbc2_tLM_pred, x = TRUE)
summary(coxFit)
coxFit$x
PredError <- pec(list("Cox" = coxFit), Hist(years4_censure, status2_censure)~1, data = pbc2_tLM_pred)
plot(PredError)
?coxph
?pec
coxFit$formula
PredError <- pec(list("Cox" = coxFit), coxFit$formula, data = pbc2_tLM_pred)
test <- na.omit(pbc2_tLM_pred)
PredError <- pec(list("Cox" = coxFit), coxFit$formula, data = test)
plot(PredError)
?model.matrix
pbc2_tLM_pred_na <- model.matrix(coxFit$formula, pbc2_tLM_pred)
pbc2_tLM_pred_na <- na.omit(model.matrix(coxFit$formula, pbc2_tLM_pred))
PredError <- pec(list("Cox" = coxFit), coxFit$formula, data = pbc2_tLM_pred_na)
pbc2_tLM_pred_na <- na.omit(data.frame(model.matrix(coxFit$formula, pbc2_tLM_pred)))
View(pbc2_tLM_pred_na)
PredError <- pec(list("Cox" = coxFit), coxFit$formula, data = pbc2_tLM_pred_na)
coxFit$x
coxFit$y
coxFit$formula
pbc2_tLM_pred_na <- na.omit(pbc2_tLM_pred[,c("years4_censure","status2_censure",
"age","serBilir2","serChol2","serChol2_slope",
"albumin2_slope")])
PredError <- pec(list("Cox" = coxFit), coxFit$formula, data = pbc2_tLM_pred_na)
plot(PredError)
?plot.pec
git rm -r --cached .Rproj.user/**
